#include <stdio.h>
#include <stdlib.h>
#include "SMS.h"
#include <locale.h>
#include "utf.h"

#define DSC_to_msg(DSC) (DSC == 0 ? "Bit7" : (DSC == 1 ? "Bit8" : "UCS2"))

int main() {

    char *out;
    int len;
    out = (char*)malloc(1024);

    //struct SMS_Struct s = PDUDecoding("0891683108502905F0040D91683159298373F70008512111013253232A00610062006300640065006600670040002400250022002A002D98769876987698769876987698769876");
    //struct SMS_Struct s = PDUDecoding("0891683108502905F0040D91683159298373F70000512101616500232261F1985C369F01234149A46ABD50A990E8A4DBB17E31D9AC56B3DD703918");
    //struct SMS_Struct s = PDUDecoding("0891683108801505F94405A10180F60008512111901592238C0500035F02014E3A5E86795D8D355DDE79FB52A800340047002B8BD555467528FF0C6211516C53F8672C6708541160A88D60900177015185514D8D39901A8BDD65F6957F00310030003000305206949FFF084EF7503C0032003000305143FF09FF0C4E0E60A851714EAB7CBE5F6979FB52A800340047751F6D3BFF016CE8FF1A8D60900165F6957F4EC59650");
    //SMS_Struct s = sms->PDUDecoding("0011000D91683118307447F50000A70100");
    //struct SMS_Struct s = PDUDecoding("0891683108502905F0400D91683159298373F70008512141615053238C0500031502015C0A656C76845BA26237FF0C60A8597DFF0160A84E8E00320030003100355E740031003267080031003165E50031003870B900350038520670B964AD621663A565364E864E2D56FD79FB52A87684632F94C30032002E0030003051434E1A52A1FF0C8D448D390032002E00300030514330025982679C60A890475230672A653652305DF270B9");
    struct SMS_Struct s = PDUDecoding(
           "0891683108502905F0440D91683159298373F70008512141615093238005000315020264AD4FE1606F3001653652304FE1606F4E0E5BA34F204E0D7B267B4995EE989862165BF9670D52A14E0D6EE1610FFF0C53EF57280031003267080031003165E50032003270B9003300355206524D56DE590D0032003500370033FF0C62114EEC5C064E0D653653D660A876848D39752830024E2D56FD79FB52A8");
    //SMS_Struct s = sms->PDUDecoding("0891683110602305F0040D91685175605321F40000512161716000230761F1985C369F01");
    //SMS_Struct s = sms->PDUDecoding("0891683110602305F0040D91685175605321F40008512161716065230C4E2D56FD4EBA4E2D56FD4EBA");

    printf("服务中心地址: %s\n", s.SCA);
    printf("发送方地址: %s\n", s.OA);
    printf("服务中心时间戳: %s\n", s.SCTS);
    printf("消息内容: %s\n", s.UD);
    printf("数据编码方案： %s\n", DSC_to_msg(s.DCS));
    printf("消息类型： %d\n", s.MC);

    printf("\n测试编码\n");
    char *msg = "你是谁？test hello!哈#@我看将了的罚款拉大方急啊士大夫阿达发射的将发卡十大经典分开了阿斯顿附件阿斯顿看了几发达附件阿斯顿颗粒的发达反倒是方阿斯顿方阿达方阿斯顿发速度噶速度高飞的该";
    //char *msg = "adhfasjj3r34-534=53450323#@*()$*_)jkjf*@#$__#++U_@*)(U_)UJ83239239u35j02=1-189hj1=111834449^^%%#&*&#*((()&kfjdafjdasfoH*ty8&*T6:7G&6Rg&*t6oG&F^&F(^&ROG&*^&GOG7$%^&*_#$IFG^&TF90&&^@)@_+)*(^&++8娃娃";
    //char *msg = "这是从rild发出的测试短信!";
    //char *msg = "abcdefg?@#$%^&*)(*_";

    struct PDUS *pdus = PDUEncoding("+8613811420981", msg, NULL);
    printf("长短信编码：\n");

    for (int i = 0; i < pdus->count; i++) {
        printf("第 %d 条:\n", i + 1);
        printf("%s\n", pdus->PDU[i]);
    }

    return 0;
}
